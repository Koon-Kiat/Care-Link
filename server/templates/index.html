<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensor Data</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background-color: #f9fafb;
        }
        
        h1 {
            text-align: center;
            color: #1a1a1a;
            margin-bottom: 2rem;
        }
        
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(8px);
        }
        
        .title {
            font-size: 0.875rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        
        .value {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .safe { color: #4ade80; }
        .warning { color: #fbbf24; }
        .danger { color: #ef4444; }
        
        .status-indicator {
            height: 8px;
            width: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 0.5rem;
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .temperature-gauge {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        
        .temperature-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease-out;
        }
    </style>
    <script>
        function getStatusColor(status) {
            status = status.toLowerCase();
            return status === 'safe' ? 'safe' : 
                   status === 'warning' ? 'warning' : 'danger';
        }
        
        function getTemperatureColor(temp) {
            return temp >= 39 ? 'danger' :
                   temp >= 37.5 ? 'warning' : 'safe';
        }
        
        async function fetchData() {
            try {
                const response = await fetch('/api/sensordata');
                const data = await response.json();
                
                // Update Fall Status
                const fallStatusEl = document.getElementById('fallStatus');
                const fallStatusClass = getStatusColor(data.fall_status);
                fallStatusEl.textContent = data.fall_status;
                fallStatusEl.className = `value ${fallStatusClass}`;
                document.getElementById('fallIndicator').className = `status-indicator bg-${fallStatusClass}`;

                                // Update Fall Status
                const medStatusEl = document.getElementById('medStatus');
                const medStatusClass = getStatusColor(data.med_status);
                medStatusEl.textContent = data.med_status;
                medStatusEl.className = `value ${medStatusClass}`;
                document.getElementById('medIndicator').className = `status-indicator bg-${medStatusClass}`;
                
                // Update Activity Status
                document.getElementById('activityStatus').textContent = data.activity_status;
                
                // Update Temperature
                const tempEl = document.getElementById('temperature');
                const tempClass = getTemperatureColor(data.temperature);
                tempEl.textContent = `${data.temperature}Â°C`;
                tempEl.className = `value ${tempClass}`;
                
                const tempFill = document.getElementById('temperatureFill');
                tempFill.style.width = `${(data.temperature / 45) * 100}%`;
                tempFill.className = `temperature-fill bg-${tempClass}`;
                
                // Update Timestamp
                const date = new Date(data.timestamp);
                document.getElementById('timestamp').textContent = date.toLocaleString();
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Fetch data every 2 seconds
        setInterval(fetchData, 2000);
        
        // Initial fetch when page loads
        window.onload = fetchData;
    </script>
</head>
<body>
    <h1>Live Sensor Data</h1>
    <div class="sensor-grid">
        <div class="card">
            <div class="title">Fall Status</div>
            <div>
                <span id="fallStatus" class="value">Loading...</span>
                <span id="fallIndicator" class="status-indicator"></span>
            </div>
        </div>
        
        <div class="card">
            <div class="title">Activity Status</div>
            <div id="activityStatus" class="value">Loading...</div>
        </div>
        
        <div class="card">
            <div class="title">Temperature</div>
            <div id="temperature" class="value">Loading...</div>
            <div class="temperature-gauge">
                <div id="temperatureFill" class="temperature-fill"></div>
            </div>
        </div>
        
        <div class="card">
            <div class="title">Last Updated</div>
            <div id="timestamp" class="value">Loading...</div>
        </div>

        <div class="card">
            <div class="title">Medication Status</div>
            <div>
                <span id="medStatus" class="value">Loading...</span>
                <span id="medIndicator" class="status-indicator"></span>
            </div>
        </div>

    </div>
</body>
</html>